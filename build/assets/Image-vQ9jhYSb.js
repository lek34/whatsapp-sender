import{r as m,j as e}from"./index-D4Ddltd5.js";import{a as R,r as k,u as E,S as i}from"./axios-kRgXoQhS.js";import{C as P,a as U}from"./CRow-DMjowzGT.js";import{C as O,a as W}from"./CCardBody-HCNMLPT6.js";import{C as D}from"./CCardHeader-BmkCMfNv.js";import{C as L}from"./CForm-Bd6HCFkr.js";import{b as w}from"./index.esm-DVwSU7ju.js";import{C as V}from"./CInputGroup-B2QZZNvZ.js";import{C as g}from"./CFormInput-C5aBT7wH.js";import{C as Y}from"./CButton-CtFRGoiF.js";import"./CFormControlWrapper---ddIf9L.js";import"./CFormControlValidation-BrZu_tOP.js";async function _(l){return(await R.post("http://localhost:8080/api/v1/sendphoto",l,{headers:{"API-KEY":"124421412414141","Content-Type":"multipart/form-data"}})).data}const te=()=>{const l=m.useRef(null),c=m.useRef(null),[p,d]=m.useState(""),[x,f]=m.useState(null),[h,C]=m.useState(!1),b=()=>p.trim()===""||!x?(i.fire({title:"Validation Error",text:"Phone Number and Image cannot be empty!",icon:"warning",confirmButtonText:"Ok"}),!1):!0,j=o=>{var u;const t=(u=o.target.files)==null?void 0:u[0];if(!t)return;const r=new FileReader;r.onload=s=>{var n;const a=(n=s.target)==null?void 0:n.result;if(a&&typeof a=="object"){const B=new Uint8Array(a),y=k(B,{type:"array"}),A=y.SheetNames[0],F=y.Sheets[A],T=E.sheet_to_json(F,{header:1});v(T),l.current&&(l.current.value="")}},r.readAsArrayBuffer(t)},S=o=>{var r;const t=(r=o.target.files)==null?void 0:r[0];if(t){if(!t.name.endsWith(".jpg")&&!t.name.endsWith(".png")){i.fire({title:"Invalid File Type",text:"Please upload a valid image file (.jpg or .png).",icon:"error",confirmButtonText:"Ok"}),c.current&&(c.current.value="");return}f(t)}else f(null)},I=async()=>{if(!b())return;C(!0);const t=p.split(",").map(s=>s.trim()).map(async s=>{const a=new FormData;return a.append("recipient",s),a.append("file",x),await _(a)}),u=(await Promise.all(t)).every(s=>s.error==="false");C(!1),u?(d(""),f(null),l.current&&(l.current.value=""),c.current&&(c.current.value=""),i.fire({title:"Success!",text:"All images sent successfully!",icon:"success",confirmButtonText:"Ok"})):i.fire({title:"Error!",text:"Some images failed to send.",icon:"error",confirmButtonText:"Ok"})},v=o=>{i.fire({title:"Select Row and Column",html:`
        <p>Select the row and column for the phone numbers:</p>
        <input id="col-input" type="text" placeholder="Column letter (e.g., A)" style="width: 100%; margin-top: 10px;" />
        <input id="row-input" type="number" placeholder="Starting Row number" min="1" style="width: 100%; margin-top: 10px;" />
      `,showCancelButton:!0,confirmButtonText:"Submit",preConfirm:()=>{const t=document.getElementById("row-input").value,r=document.getElementById("col-input").value.toUpperCase();return!t||!r||r.length!==1||!/^[A-Z]$/.test(r)?(i.showValidationMessage("Please enter valid row number and column letter."),!1):{row:parseInt(t),col:r}}}).then(t=>{if(t.isConfirmed){const{row:r,col:u}=t.value,s=u.charCodeAt(0)-65,a=o.map(n=>n[s]?n[s].toString():null).slice(r-1).filter(n=>n).map(n=>n.startsWith("08")?"62"+n.substring(1):n.startsWith("8")?"62"+n:n);a.length>0?d(a.join(", ")):i.fire({title:"Error!",text:"No phone numbers found in the specified range.",icon:"error",confirmButtonText:"Ok"})}})},N=()=>{i.fire({title:"Warning!",text:"Are you sure you want to send the image?",icon:"warning",showCancelButton:!0,cancelButtonText:"No",confirmButtonText:"Yes"}).then(o=>{o.isConfirmed&&I()})};return e.jsx(P,{children:e.jsx(U,{xs:12,children:e.jsxs(O,{className:"mb-4",children:[e.jsx(D,{children:e.jsx("strong",{children:"Upload Image"})}),e.jsx(W,{children:e.jsxs(L,{onSubmit:o=>{o.preventDefault(),N()},children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(w,{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsxs(V,{className:"mb-3",children:[e.jsx(g,{type:"file",id:"fileInput",ref:l,onChange:j}),e.jsx(g,{type:"text",id:"phoneNumber",value:p,onChange:o=>d(o.target.value)})]}),e.jsx(w,{htmlFor:"image",children:"Image"}),e.jsx(g,{type:"file",id:"imageInput",ref:c,onChange:S})]}),e.jsx(Y,{color:"primary",type:"submit",disabled:h,children:h?"Sending...":"Send Image"}),h&&e.jsx("div",{className:"loading-indicator",children:"Sending..."})]})})]})})})};export{te as default};
